**Дата:** 20 сентября 2023 г.

**Статус:** Принято

**Контекст:**

Система поиска и рекомендаций ресторанов требует эффективного полнотекстового поиска по ресторанам с поддержкой фильтрации по множественным критериям (название, тип кухни, местоположение, рейтинг, ценовая категория). PostgreSQL имеет встроенный полнотекстовый поиск, но для сложных запросов может потребоваться специализированное решение.

**Рассмотренные варианты:**

1. **PostgreSQL Full-Text Search:** Встроенные возможности PostgreSQL для полнотекстового поиска. Не требует дополнительной инфраструктуры.
2. **Elasticsearch:** Специализированная поисковая система на основе Apache Lucene. Мощные возможности поиска, агрегации, аналитики.
3. **Apache Solr:** Альтернатива Elasticsearch на основе Lucene. Похожий функционал, но менее популярен.
4. **Algolia:** Управляемый поисковый сервис. Простое API, но платный и менее гибкий.

**Решение:**

Выбран PostgreSQL Full-Text Search на начальном этапе с возможностью миграции на Elasticsearch при необходимости масштабирования.

**Обоснование:**

- **Простота:** Не требует дополнительной инфраструктуры и синхронизации данных между системами.
- **Достаточность:** Встроенный полнотекстовый поиск PostgreSQL покрывает большинство требований на начальном этапе (поиск по названию, описанию, типу кухни).
- **Производительность:** Для ожидаемой нагрузки (до 20 000 активных пользователей) PostgreSQL справится с задачей поиска.
- **Консистентность данных:** Данные находятся в одной системе, что упрощает поддержку консистентности.
- **Гибкость:** Архитектура позволяет в будущем добавить Elasticsearch для более сложных сценариев поиска без изменения основной логики.

**Недостатки решения:**

- **Ограниченные возможности:** По сравнению с Elasticsearch, возможности полнотекстового поиска PostgreSQL более ограничены (менее гибкий релевантный поиск, нет фасетного поиска "из коробки").
- **Масштабирование:** При очень больших объемах данных может потребоваться переход на специализированное решение.

**Последствия:**

- Необходимо правильно настроить индексы полнотекстового поиска в PostgreSQL (GIN индексы для tsvector).
- Требуется реализовать эффективные запросы с использованием ts_rank для ранжирования результатов.
- При необходимости добавления сложных фильтров и агрегаций следует рассмотреть миграцию на Elasticsearch.
- Рекомендуется документировать процесс миграции на Elasticsearch для будущего масштабирования.

