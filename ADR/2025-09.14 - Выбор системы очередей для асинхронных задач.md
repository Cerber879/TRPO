**Дата:** 20 сентября 2025 г.

**Статус:** Принято

**Контекст:**

Нужно выполнять асинхронные задачи, которые не должны блокировать основной поток обработки запросов пользователей. К таким задачам относятся: обработка изображений, пересчет рейтингов, генерация рекомендаций, отправка уведомлений, индексация данных для поиска.

**Рассмотренные варианты:**

1. **RabbitMQ:** Популярный брокер сообщений с поддержкой различных паттернов обмена сообщениями. Надежный, но требует настройки.
2. **Apache Kafka:** Распределенная платформа потоковой обработки данных. Отлично для больших объемов данных и event streaming.
3. **Redis как очередь:** Использование Redis Lists или Streams для простых очередей задач. Легко, но менее функционально.
4. **Amazon SQS / Google Cloud Tasks:** Управляемые сервисы очередей. Простое использование, но зависимость от облачного провайдера.

**Решение:**

Выбран RabbitMQ как основной брокер сообщений для всех асинхронных задач.

**Обоснование:**

- **Надежность:** RabbitMQ обеспечивает гарантии доставки сообщений и персистентность, что критично для важных задач (обработка изображений, пересчет рейтингов, отправка уведомлений).
- **Гибкость:** Поддержка различных паттернов обмена сообщениями (direct, topic, fanout) позволяет реализовать сложные сценарии маршрутизации.
- **Масштабируемость:** RabbitMQ поддерживает кластеризацию и позволяет масштабировать обработку задач горизонтально.
- **Мониторинг:** Встроенный веб-интерфейс для мониторинга очередей и состояния брокера.
- **Опыт команды:** У нас уже есть опыт работы с RabbitMQ, что упростит настройку и интеграцию. Мы знаем, как правильно настроить очереди, обработку ошибок и retry-механизмы.

**Недостатки решения:**

- **Инфраструктура:** Требует настройки и поддержки отдельного сервиса, но это оправдано надежностью и функциональностью.
- **Ресурсы:** Потребляет дополнительные ресурсы сервера, но для наших задач это приемлемо.

**Последствия:**

- Настроим RabbitMQ с учетом нашего опыта: правильная конфигурация очередей, exchanges и bindings.
- Реализуем механизмы retry и dead letter queues для обработки неудачных задач.
- Настроим мониторинг длины очередей и производительности брокера.
- Используем наш опыт для оптимизации производительности и надежности системы очередей.

