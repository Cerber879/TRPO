@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Restaurant Service - Диаграмма компонентов

Container(restaurant_service_container, "Restaurant Service", "Kotlin", "Микросервис управления ресторанами и карточками")

System_Boundary(restaurant_service_boundary, "Restaurant Service") {
    Component(rest_controller, "REST Controller", "Spring Web", "Обрабатывает HTTP запросы от API Gateway")
    
    Component(restaurant_service_layer, "Restaurant Service", "Kotlin", "Основная бизнес-логика управления ресторанами")
    Component(restaurant_repository, "Restaurant Repository", "Spring Data JPA", "Управление данными ресторанов")
    
    Component(redis_client, "Redis Client", "Lettuce", "Клиент для работы с Redis")
    
    Component(auth_client, "Auth Client", "Kotlin HTTP Client", "HTTP клиент для проверки прав доступа")
    Component(image_client, "Image Client", "Kotlin HTTP Client", "HTTP клиент для работы с Image Service")
    
    Component(rabbitmq_producer, "RabbitMQ Producer", "Spring AMQP", "Отправка событий в RabbitMQ")
    
    Component(validation_component, "Validation Component", "Kotlin", "Валидация данных ресторанов")
    
    Component(event_handler, "Event Handler", "Kotlin", "Обработка входящих событий из RabbitMQ")
}

ContainerDb(db_postgres, "PostgreSQL", "SQL Database", "Единая база данных")
Container(redis_cache, "Redis", "", "Распределенное кэширование")
Container(rabbitmq, "RabbitMQ", "", "Брокер сообщений")
Container(auth_service, "Auth Service", "Kotlin", "Микросервис аутентификации")
Container(image_service, "Image Service", "Kotlin", "Микросервис обработки изображений")

Rel(rest_controller, restaurant_service_layer, "Вызывает операции с ресторанами", "Kotlin calls")
Rel(rest_controller, auth_client, "Проверка прав доступа", "Kotlin calls")

Rel(restaurant_service_layer, restaurant_repository, "Управление данными", "Kotlin calls")
Rel(restaurant_service_layer, redis_client, "Кэширование данных", "Kotlin calls")
Rel(restaurant_service_layer, validation_component, "Валидация данных", "Kotlin calls")
Rel(restaurant_service_layer, image_client, "Работа с изображениями", "Kotlin calls")
Rel(restaurant_service_layer, rabbitmq_producer, "Отправка событий", "Kotlin calls")

Rel(restaurant_repository, db_postgres, "Чтение/запись ресторанов", "SQL")
Rel(redis_client, redis_cache, "Кэширование/получение данных", "Redis Protocol")

Rel(auth_client, auth_service, "Проверка токенов и прав", "HTTP")
Rel(image_client, image_service, "Загрузка/получение изображений", "HTTP")

Rel(rabbitmq_producer, rabbitmq, "Отправка событий", "AMQP")
Rel(rabbitmq, event_handler, "Получение событий", "AMQP")
Rel(event_handler, restaurant_service_layer, "Обработка событий", "Kotlin calls")

@enduml

